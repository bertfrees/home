* .zshrc

#+NAME: .zshrc
#+BEGIN_SRC sh :tangle .zshrc
# This file is automatically generated from .zshrc.org. Don't make
# changes to this file directly.

# if not running interactively, don't do anything
[ -z "$PS1" ] && return

# same as $(brew --prefix)
case "$(uname -m)" in
	x86_64)
		BREW_HOME=/usr/local
		;;
	aarch64|arm64)
		BREW_HOME=/opt/homebrew
		;;
esac

PATH=$BREW_HOME/bin:$PATH
PATH=$HOME/bin:$PATH
PATH="/opt/homebrew/opt/gnu-sed/libexec/gnubin:$PATH"

export VISUAL=$HOME/bin/emacs # FIXME: don't pass --no-wait?
export EDITOR=$HOME/bin/editor

export PASSWORD_STORE_DIR=$HOME/src/github/bertfrees/password-store

export HOMEBREW_NO_INSTALL_CLEANUP=TRUE

if [ -z "$JAVA_HOME" ]; then
    export JAVA_HOME=$BREW_HOME/opt/openjdk@17
fi

setopt NO_BEEP

# ------------------------------------------------------------------
# COMPLETION
# ------------------------------------------------------------------

fpath=($fpath $BREW_HOME/share/zsh/site-functions)
autoload -Uz compinit
compinit

# ------------------------------------------------------------------
# EMACS
# ------------------------------------------------------------------

# see https://github.com/akermu/emacs-libvterm?tab=readme-ov-file#directory-tracking-and-prompt-tracking

vterm_printf() {
    if [ -n "$TMUX" ] && ([ "${TERM%%-*}" = "tmux" ] || [ "${TERM%%-*}" = "screen" ]); then
        # Tell tmux to pass the escape sequences through
        printf "\ePtmux;\e\e]%s\007\e\\" "$1"
    elif [ "${TERM%%-*}" = "screen" ]; then
        # GNU screen (screen, screen-256color, screen-256color-bce)
        printf "\eP\e]%s\007\e\\" "$1"
    else
        printf "\e]%s\e\\" "$1"
    fi
}
vterm_prompt_end() {
    vterm_printf "51;A$(whoami)@$(hostname):$(pwd)"
}
setopt PROMPT_SUBST
PROMPT=$PROMPT'%{$(vterm_prompt_end)%}'
vterm_cmd() {
    local vterm_elisp
    vterm_elisp=""
    while [ $# -gt 0 ]; do
        vterm_elisp="$vterm_elisp""$(printf '"%s" ' "$(printf "%s" "$1" | sed -e 's|\\|\\\\|g' -e 's|"|\\"|g')")"
        shift
    done
    vterm_printf "51;E$vterm_elisp"
}

# set terminal window title to directory or program name (in Emacs, set vterm-buffer-name-string to "vterm %s")
case $TERM in
  (*xterm* | rxvt | rxvt-unicode-256color | xterm-256color)
    function precmd {
      print -Pn "\e]0;%(1j,%j job%(2j|s|); ,)%~\a"
    }
    function preexec {
      printf "\033]0;%s\a" "$1"
    }
  ;;
esac

export NVM_DIR="$HOME/.nvm"
[ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"  # This loads nvm
[ -s "$NVM_DIR/bash_completion" ] && \. "$NVM_DIR/bash_completion"  # This loads nvm bash_completion

#+END_SRC
