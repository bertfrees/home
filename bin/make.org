* GNU Make

#+NAME: emacs
#+BEGIN_SRC clojure :tangle make :tangle-mode (identity #o755)
#!/usr/bin/env bb

;; This file is automatically generated from emacs.org. Don't make
;; changes to this file directly.

(require '[babashka.process :refer [exec sh]]
         '[clojure.java.io :as io])

(let [brew-home (io/file (case (.trim (:out (sh "uname -m")))
                           "x86_64" "/usr/local"
                           "/opt/homebrew"))
      gmake (io/file brew-home "bin/gmake")]
  (when-not (.exists gmake)
    (if-let [install (try
                       (require '[lib :refer [install]])
                       (resolve 'install)
                       (catch java.io.FileNotFoundException e
                         nil))]
      (install {:type :brew :formula "make"})
      ;; program was not called with ../.make/bb
      (do (binding [*out* *err*]
            (println (.getAbsolutePath gmake) "is not installed"))
          (System/exit 1))))
  (apply exec gmake ,*command-line-args*))
#+END_SRC
