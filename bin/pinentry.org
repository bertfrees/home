* Pinentry program

Pinentry program for GnuPG

#+NAME: pinentry
#+BEGIN_SRC clojure :tangle pinentry :tangle-mode (identity #o755)
#!/usr/bin/env bb

;; This file is automatically generated from pinentry.org. Don't make
;; changes to this file directly.

(require '[babashka.process :refer [exec sh]]
         '[clojure.java.io :as io])

(let [brew-home (io/file (case (.trim (:out (sh "uname -m")))
                           "x86_64" "/usr/local"
                           "/opt/homebrew"))
      pinentry-mac (io/file brew-home "bin/pinentry-mac")]
  (when-not (.exists pinentry-mac)
    (let [home-dir (.getParentFile (.getParentFile (io/file *file*)))]
      (when (not (= 0 (:exit (sh {:dir home-dir :out :inherit :err :inherit}
                             "bin/make" (.getPath pinentry-mac)))))
        (System/exit 1))))
  (apply exec pinentry-mac ,*command-line-args*))
#+END_SRC
